<html>
<head>
<script src="https://code.jquery.com/jquery-3.1.0.js"></script>

<script>

////////////////////////////////////////////////////////////
// API
function tt_rss_query(op,params,cb) {
	const data = JSON.stringify($.extend({"op" : op},params));
	console.log("Query " + data);
	return $.post(
		"http://serveur.kaisser.name/tt-rss/api/",
		data,
		cb,
		"json"
	);
}

function tt_rss_id_query_params(op,sid,ext_params,cb) {
	const params = $.extend({"sid" : sid},ext_params);
	return tt_rss_query (op, params,cb);
}

function tt_rss_id_query(op,sid,cb) {
	return tt_rss_id_query_params (op, sid, {}, cb);
}

function tt_rss_get_headline(sid, feed_id, limit, cb) {
	return tt_rss_id_query_params( "getHeadlines", sid, {"feed_id" : feed_id, "limit" : limit} , cb );
}
//
// END OF API
////////////////////////////////////////////////////////////


function write_entries (id) {
	return function ( data ) {
		const entries = data.content;
		const titles = entries.map(function(e){return	e.title} )
		$("p#" + id).html(titles.join("<br>\n"));
	}
}

tt_rss_query("login", {"user":"florent","password":"celia82"}, 
	function ( data ) {
		const sid = data.content.session_id;
		tt_rss_get_headline (sid, -3, 30, write_entries("fresh"));
		tt_rss_get_headline (sid, "299", 10, write_entries("google_news_une"));
		tt_rss_get_headline (sid, "300", 10, write_entries("google_sci_tech"));
		tt_rss_get_headline (sid, "302", 10, write_entries("hn"));
	}
)


</script>
</head>
<body>
<h2>Feed</h2>
<p id="fresh">Chargement ...</p>

<h2>Ã€ la Une</h2>
<p id="google_news_une">Chargement ...</p>

<h2>Science/High-tech</h2>
<p id="google_sci_tech">Chargement ...</p>

<h2>Hacker news</h2>
<p id="hn">Chargement ...</p>

</body>
</html>
